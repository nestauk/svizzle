<script>
	import Icon from '@svizzle/ui/src/icons/Icon.svelte';
	import Square from '@svizzle/ui/src/icons/feather/Square.svelte';
	import CheckSquare from '@svizzle/ui/src/icons/feather/CheckSquare.svelte';
	import {noop} from '@svizzle/utils';

	import {
		deselectAllRegions,
		nutsRegionsStore,
		preselectedNUTS1IdStore,
		selectAllRegions,
		toggleRegionNUTS1,
	} from 'stores/regionSelection';

	export let title;

	const onMouseEnter = id => () => {
		$preselectedNUTS1IdStore = id;
	}
	const onMouseLeave = () => () => {
		$preselectedNUTS1IdStore = null;
	}
	const onClick = id => () => {
		toggleRegionNUTS1(id);
	}
</script>

<div
	class='RegionsSelector'
	on:click|stopPropagation={noop}
>
	{#if title}
		<h2>{title}</h2>
	{/if}
	<ul>
		{#each $nutsRegionsStore as {id, name, selected}}
			<li
				class='clickable'
				on:click={onClick(id)}
				on:mouseenter={onMouseEnter(id)}
				on:mouseleave={onMouseLeave(id)}
			>
				<span class='checker'>
					{#if selected}
						<Icon
							glyph={CheckSquare}
							size={20}
						/>
					{:else}
						<Icon
							glyph={Square}
							size={20}
						/>
					{/if}
				</span>
				<span>{name}</span>
			</li>
		{/each}

		<li
			class='end sep clickable'
			on:click={() => selectAllRegions()}
		>
			<span>Select all</span>
			<span class='checker'>
				<Icon
					glyph={CheckSquare}
					size={20}
					stroke='palegreen'
				/>
			</span>
		</li>
		<li
			class='end clickable'
			on:click={() => deselectAllRegions()}
		>
			<span>Deselect all</span>
			<span class='checker'>
				<Icon
					glyph={Square}
					size={20}
					stroke='red'
				/>
			</span>
		</li>
	</ul>
</div>

<style>
	.RegionsSelector {
		cursor: auto;
		height: 100%;
		overflow-y: auto;
		width: 100%;
	}

	ul {
		width: 100%;
	}

	li {
		width: 100%;
		display: flex;
		align-items: center;
	}

	li.end {
		justify-content: flex-end;
	}
	li.sep {
		margin-top: 0.5rem;
	}

	li:hover {
		background-color: rgba(200,200,200,0.2);
	}

	.checker {
		margin-right: 0.5rem;
	}

	li.end .checker {
		margin: 0 0 0 0.5rem;
	}

	.clickable {
		cursor: pointer;
	}
</style>
