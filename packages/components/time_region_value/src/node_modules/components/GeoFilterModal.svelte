<script>
	import Icon from '@svizzle/ui/src/icons/Icon.svelte';
	import Square from '@svizzle/ui/src/icons/feather/Square.svelte';
	import CheckSquare from '@svizzle/ui/src/icons/feather/CheckSquare.svelte';
	import {values} from 'lamb';

	import {
		deselectAllRegions,
		preselectedNUTS1IdStore,
		selectAllRegions,
		toggleRegionNUTS1
	} from 'stores/regionSelection';
	import {noop} from 'utils/generic';

	export let nutsSelectionStore;

	$: regions = values($nutsSelectionStore);

	const onMouseEnter = id => () => {
		$preselectedNUTS1IdStore = id;
	}
	const onMouseLeave = () => () => {
		$preselectedNUTS1IdStore = null;
	}
	const onClick = id => () => {
		toggleRegionNUTS1(id);
	}
</script>

<div
	class='clickable modal'
	on:click
>
	<div
		class='panel'
		on:click|stopPropagation={noop}
	>
		<h2>NUTS1 regions</h2>
		<ul>
			{#each regions as {id, name, selected}}
			<li
				class='clickable'
				on:click={onClick(id)}
				on:mouseenter={onMouseEnter(id)}
				on:mouseleave={onMouseLeave(id)}
			>
				<span class='checker'>
					{#if selected}
						<Icon
							glyph={CheckSquare}
							size={20}
						/>
					{:else}
						<Icon
							glyph={Square}
							size={20}
						/>
					{/if}
				</span>
				<span>{name}</span>
			</li>
			{/each}

			<li
				class='end sep clickable'
				on:click={() => selectAllRegions()}
			>
				<span>Select all</span>
				<span class='checker'>
					<Icon
						glyph={CheckSquare}
						size={20}
						stroke='palegreen'
					/>
				</span>
			</li>
			<li
				class='end clickable'
				on:click={() => deselectAllRegions()}
			>
				<span>Deselect all</span>
				<span class='checker'>
					<Icon
						glyph={Square}
						size={20}
						stroke='red'
					/>
				</span>
			</li>
		</ul>
	</div>
</div>

<style>
	.modal {
		align-items: flex-start;
		background-color: rgba(255,255,255,0.25);
		cursor: pointer;
		display: flex;
		height: 100%;
		justify-content: flex-start;
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
	}

	.panel {
		background-color: rgba(255,255,255,0.75);
		border: 1px solid var(--colorRefLight);
		box-shadow: var(--dimBoxShadowXY) var(--colorRefLight);
		max-height: 80%;
		max-width: 800px;
		padding: 1rem;
		overflow-y: auto;
		cursor: auto;
		margin: auto;
	}

	ul {
		width: 100%;
	}

	li {
		width: 100%;
		display: flex;
		align-items: center;
	}

	li.end {
		justify-content: flex-end;
	}
	li.sep {
		margin-top: 0.5rem;
	}

	li:hover {
		background-color: rgba(200,200,200,0.2);
	}

	.checker {
		margin-right: 0.5rem;
	}

	li.end .checker {
		margin: 0 0 0 0.5rem;
	}
</style>
